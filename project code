#BUS 462 Group Project - Codebase
#Team E.Kappa
#April 5, 2022

#Clearing mem buffers
cat("\014")  #Clear Console
rm(list = ls(all.names = TRUE))# clear all
gc()
set.seed(42) #Set a seed to ensure repeatable random samples

#Libraries
require(data.table)
require(pastecs)
require(stargazer)
require(PerformanceAnalytics)

data <- fread("/Users/aliciachow/Documents/4th Year/BUS 462/Datasets/credit_data.csv")
colSums(is.na(data))
data <- na.omit(data)

#Change data type of variables to integers

data$credit_history <- as.integer(factor(data$credit_history, levels = c("'critical/other existing credit'", "'existing paid'",  "'delayed previously'", "'no credits/all paid'" ,"'all paid'" )))
data$purpose <- as.integer(factor(data$purpose, levels = c("radio/tv","education","furniture/equipment","'new car'","'used car'","business","'domestic appliance'","repairs","other","retraining")))
data$property_magnitude <- as.integer(factor(data$property_magnitude, levels = c("'real estate'","'life insurance'","'no known property'","car")))
data$housing<- as.integer(factor(data$housing, levels = c("own", "'for free'","rent")))
data$own_telephone<- as.integer(factor(data$own_telephone, levels = c("yes","none")))

#Q1 - What variables should be focused on while evaluating credit amount?

#To get the correlation chart of all variables.
chart.Correlation(data, histogram=TRUE, pch=19)

# OLS model 
m.OLS<-lm(credit_amount ~ ., data=data)

# Looking at the summary results from the OLS regression model
summary(m.OLS)
AIC(m.OLS)
stargazer(m.OLS,type="text")

#Stepwise Regression
model.step.OLS <- step(m.OLS) 

# Looking at the summary results from the Stepwise regression 
stargazer(m.OLS,model.step.OLS,type="text")
summary(model.step.OLS)
AIC(model.step.OLS)

#Q2 - How does the scale of purchases affect oneâ€™s credit amount? That is, are individuals more likely to pay off their credit or less likely when purchasing larger items (which may take longer to pay off)?
#Dependent Variable: Credit Amount
#Independent Variables: Purpose, Credit History, Duration, Property Magnitude, Housing, Telephone (assuming it is similar to a mobile device and will be quite expensive)

dataq2<-subset(data,select=c(purpose, credit_history,duration,property_magnitude,housing,own_telephone,credit_amount))
stat.desc(dataq2)

#To get the correlation chart of all variables.
chart.Correlation(dataq2, histogram=TRUE, pch=19)

# We can also visualize the correlations utilizing a correlogram
install.packages("corrplot")
library(corrplot)

cor_data<-cor(dataq2)
corrplot(cor_data, method="number", "upper")

#run the OLS model
OLSModel <- lm(credit_amount ~ purpose + credit_history + duration + property_magnitude + housing + own_telephone, data=dataq2)

# Let's look at the summary results from the OLS regression model
summary(OLSModel)
stargazer(OLSModel,type="text")
AIC(OLSModel)

# Visualize the relationship between the various purchasing habits (purpose) and the amount of credit an individual has
plot(dataq2$purpose, dataq2$credit_amount, xlab = "Purpose of Credit", ylab = "Credit Amount")
hist(dataq2$purpose, dataq2$credit_amount, xlab = "Purpose of Credit", ylab = "Credit Amount")

#OLS Model 2 (considers interaction between credit history and duration)
historyduration <- (dataq2$credit_history*dataq2$duration)
OLSModel2 <- lm(dataframeq2$credit_amount ~ dataframeq2$purpose + dataframeq2$property_magnitude + dataframeq2$housing + dataframeq2$own_telephone + historyduration, data=dataframeq2)

# Let's look at the summary results from the second OLS regression model
summary(OLSModel2)
stargazer(OLSModel2,type="text")
AIC(OLSModel2)


#Q3 - Given the loan/customer features, we want to predict the default on loans.
head(data)
tail(data)

dataq3 <- data[,c("purpose","other_parties","installment_commitment","property_magnitude", "existing_credits", "num_dependents", "personal_status", "employment", "residence_since", "age", "housing", "job", "own_telephone", "foreign_worker", "other_payment_plans")]
dataframeq3 <- data.frame(dataq3)

#Stats summary
stat.desc(dataq3)
stargazer(dataq3,type="text")

#Convert data types - need to add levels
dataq3$purpose <- as.integer(factor(dataq3$purpose, levels = c()))
dataq3$employment <- as.integer(factor(dataq3$employment, levels = c()))
dataq3$personal_status <- as.integer(factor(dataq3$personal_status, levels = c()))
dataq3$other_parties <- as.integer(factor(dataq3$other_parties))
dataq3$property_magnitude <- as.integer(factor(dataq3$property_magnitude))
dataq3$other_payment_plans <- as.integer(factor(dataq3$other_payment_plans))
dataq3$housing <- as.integer(factor(dataq3$housing))
dataq3$job <- as.integer(factor(dataq3$job))
dataq3$own_telephone <- as.integer(factor(dataq3$own_telephone))
dataq3$foreign_worker <- as.integer(factor(dataq3$foreign_worker))
dataq3$installment_commitment <- as.integer(factor(dataq3$installment_commitment))
dataq3$existing_credits <- as.integer(factor(dataq3$existing_credits))
dataq3$num_dependents <- as.integer(factor(dataq3$num_dependents))
dataq3$residence_since <- as.integer(factor(dataq3$residence_since))
dataq3$age <- as.integer(factor(dataq3$age))

#Correlation
chart.Correlation(dataframeq3) #Need to finish converting variables
